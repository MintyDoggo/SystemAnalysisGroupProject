@page "/configureartifacts"
@using Microsoft.Extensions.Configuration
@inject IHttpClientFactory ClientFactory
@inject IConfiguration Configuration

<h3>Current #of RequiredArtifact:@RequiredArtifacts?.Count</h3>
@for (int i = 0; i < RequiredArtifacts?.Count; i++)
{
    <div class="container">
        <div class="row align-items-center">
            <div class="col-md-8 offset-md-2">
                <Card>
                    <CardBody>
                        @RequiredArtifacts[i].Name
                    </CardBody>
                </Card>
            </div>
        </div>
    </div>
}

<Button Color="Color.Success" Clicked="@OnButtonClicked">Add RequiredArtifact</Button>

@for (int i = 0; i < newRequiredArtifactsNum; i++)
{
    <div class="container">
        <div class="row align-items-center">
            <div class="col-md-8 offset-md-2">
                <Card>
                    <CardBody>
                        Name: <TextEdit Placeholder="ie. Collage Transcript" />
                    </CardBody>
                </Card>
            </div>
        </div>
    </div>
}


@code
{
    public List<RequiredArtifactModel> RequiredArtifacts { get; set; }
    private int newRequiredArtifactsNum = 0;

    // Blazor event
    protected override async Task OnInitializedAsync()
    {
        await Reload();
    }

    async Task Reload()
    {
        RequiredArtifacts = new List<RequiredArtifactModel>();
        // Update our RequiredArtifacts list
        try
        {
            // The API endpoint to call
            string endpoint = Configuration.GetValue<string>("MUSMDatabaseServicesAPI") + "GetRequiredArtifacts/";

            IEnumerable<RequiredArtifactModel> getRequiredArtifactsResponse = await ClientFactory.CreateClient().GetFromJsonAsync<IEnumerable<RequiredArtifactModel>>(endpoint);
            RequiredArtifacts.Clear();
            RequiredArtifacts.AddRange(getRequiredArtifactsResponse);
        }
        catch (Exception e)
        {
            Console.WriteLine("Database services must be offline");
        }



        // always call StateHasChanged!
        StateHasChanged();
    }

    protected void OnButtonClicked()
    {
        ++newRequiredArtifactsNum;
        StateHasChanged();
    }
}
